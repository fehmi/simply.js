/**
 * History.js Native Adapter
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */
!function(window,undefined){"use strict";var History=window.History=window.History||{};if(void 0!==History.Adapter)throw new Error("History.js Adapter has already been loaded...");History.Adapter={handlers:{},_uid:1,uid:function(element){return element._uid||(element._uid=History.Adapter._uid++)},bind:function(element,eventName,callback){var uid=History.Adapter.uid(element);History.Adapter.handlers[uid]=History.Adapter.handlers[uid]||{},History.Adapter.handlers[uid][eventName]=History.Adapter.handlers[uid][eventName]||[],History.Adapter.handlers[uid][eventName].push(callback),element["on"+eventName]=function(element,eventName){return function(event){History.Adapter.trigger(element,eventName,event)}}(element,eventName)},trigger:function(element,eventName,event){event=event||{};var uid=History.Adapter.uid(element),i,n;for(History.Adapter.handlers[uid]=History.Adapter.handlers[uid]||{},History.Adapter.handlers[uid][eventName]=History.Adapter.handlers[uid][eventName]||[],i=0,n=History.Adapter.handlers[uid][eventName].length;i<n;++i)History.Adapter.handlers[uid][eventName][i].apply(this,[event])},extractEventData:function(key,event){var result;return event&&event[key]||void 0},onDomLoad:function(callback){var timeout=window.setTimeout((function(){callback()}),2e3);window.onload=function(){clearTimeout(timeout),callback()}}},void 0!==History.init&&History.init()}(window),
/**
 * History.js Core
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */
function(window,undefined){"use strict";var console=window.console||void 0,document=window.document,navigator=window.navigator,sessionStorage=!1,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,setInterval=window.setInterval,clearInterval=window.clearInterval,JSON=window.JSON,alert=window.alert,History=window.History=window.History||{},history=window.history;try{(sessionStorage=window.sessionStorage).setItem("TEST","1"),sessionStorage.removeItem("TEST")}catch(e){sessionStorage=!1}if(JSON.stringify=JSON.stringify||JSON.encode,JSON.parse=JSON.parse||JSON.decode,void 0!==History.init)throw new Error("History.js Core has already been loaded...");History.init=function(options){return void 0!==History.Adapter&&(void 0!==History.initCore&&History.initCore(),void 0!==History.initHtml4&&History.initHtml4(),!0)},History.initCore=function(options){if(void 0!==History.initCore.initialized)return!1;if(History.initCore.initialized=!0,History.options=History.options||{},History.options.hashChangeInterval=History.options.hashChangeInterval||100,History.options.safariPollInterval=History.options.safariPollInterval||500,History.options.doubleCheckInterval=History.options.doubleCheckInterval||500,History.options.disableSuid=History.options.disableSuid||!1,History.options.storeInterval=History.options.storeInterval||1e3,History.options.busyDelay=History.options.busyDelay||250,History.options.debug=History.options.debug||!1,History.options.initialTitle=History.options.initialTitle||document.title,History.options.html4Mode=History.options.html4Mode||!1,History.options.delayInit=History.options.delayInit||!1,History.intervalList=[],History.clearAllIntervals=function(){var i,il=History.intervalList;if(null!=il){for(i=0;i<il.length;i++)clearInterval(il[i]);History.intervalList=null}},History.debug=function(){History.options.debug&&History.log.apply(History,arguments)},History.log=function(){var consoleExists=!(void 0===console||void 0===console.log||void 0===console.log.apply),textarea=document.getElementById("log"),message,i,n,args,arg;for(consoleExists?(message=(args=Array.prototype.slice.call(arguments)).shift(),void 0!==console.debug?console.debug.apply(console,[message,args]):console.log.apply(console,[message,args])):message="\n"+arguments[0]+"\n",i=1,n=arguments.length;i<n;++i){if("object"==typeof(arg=arguments[i])&&void 0!==JSON)try{arg=JSON.stringify(arg)}catch(Exception){}message+="\n"+arg+"\n"}return textarea?(textarea.value+=message+"\n-----\n",textarea.scrollTop=textarea.scrollHeight-textarea.clientHeight):consoleExists||alert(message),!0},
/**
		 * History.getInternetExplorerMajorVersion()
		 * Get's the major version of Internet Explorer
		 * @return {integer}
		 * @license Public Domain
		 * @author Benjamin Arthur Lupton <contact@balupton.com>
		 * @author James Padolsey <https://gist.github.com/527683>
		 */
History.getInternetExplorerMajorVersion=function(){var result;return History.getInternetExplorerMajorVersion.cached=void 0!==History.getInternetExplorerMajorVersion.cached?History.getInternetExplorerMajorVersion.cached:function(){for(var v=3,div=document.createElement("div"),all=div.getElementsByTagName("i");(div.innerHTML="\x3c!--[if gt IE "+ ++v+"]><i></i><![endif]--\x3e")&&all[0];);return v>4&&v}()},
/**
		 * History.isInternetExplorer()
		 * Are we using Internet Explorer?
		 * @return {boolean}
		 * @license Public Domain
		 * @author Benjamin Arthur Lupton <contact@balupton.com>
		 */
History.isInternetExplorer=function(){var result;return History.isInternetExplorer.cached=void 0!==History.isInternetExplorer.cached?History.isInternetExplorer.cached:Boolean(History.getInternetExplorerMajorVersion())},History.options.html4Mode?History.emulated={pushState:!0,hashChange:!0}:History.emulated={pushState:!Boolean(window.history&&window.history.pushState&&window.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(navigator.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(navigator.userAgent))),hashChange:Boolean(!("onhashchange"in window||"onhashchange"in document)||History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8)},History.enabled=!History.emulated.pushState,History.bugs={setHash:Boolean(!History.emulated.pushState&&"Apple Computer, Inc."===navigator.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),safariPoll:Boolean(!History.emulated.pushState&&"Apple Computer, Inc."===navigator.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),ieDoubleCheck:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<7)},History.isEmptyObject=function(obj){for(var name in obj)if(obj.hasOwnProperty(name))return!1;return!0},History.cloneObject=function(obj){var hash,newObj;return obj?(hash=JSON.stringify(obj),newObj=JSON.parse(hash)):newObj={},newObj},History.getRootUrl=function(){var rootUrl=document.location.protocol+"//"+(document.location.hostname||document.location.host);return document.location.port&&(rootUrl+=":"+document.location.port),rootUrl+="/"},History.getBaseHref=function(){var baseElements=document.getElementsByTagName("base"),baseElement=null,baseHref="";return 1===baseElements.length&&(baseHref=(baseElement=baseElements[0]).href.replace(/[^\/]+$/,"")),(baseHref=baseHref.replace(/\/+$/,""))&&(baseHref+="/"),baseHref},History.getBaseUrl=function(){var baseUrl;return History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl()},History.getPageUrl=function(){var State,stateUrl,pageUrl;return pageUrl=((History.getState(!1,!1)||{}).url||History.getLocationHref()).replace(/\/+$/,"").replace(/[^\/]+$/,(function(part,index,string){return/\./.test(part)?part:part+"/"}))},History.getBasePageUrl=function(){var basePageUrl;return History.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,(function(part,index,string){return/[^\/]$/.test(part)?"":part})).replace(/\/+$/,"")+"/"},History.getFullUrl=function(url,allowBaseHref){var fullUrl=url,firstChar=url.substring(0,1);return allowBaseHref=void 0===allowBaseHref||allowBaseHref,/[a-z]+\:\/\//.test(url)||(fullUrl="/"===firstChar?History.getRootUrl()+url.replace(/^\/+/,""):"#"===firstChar?History.getPageUrl().replace(/#.*/,"")+url:"?"===firstChar?History.getPageUrl().replace(/[\?#].*/,"")+url:allowBaseHref?History.getBaseUrl()+url.replace(/^(\.\/)+/,""):History.getBasePageUrl()+url.replace(/^(\.\/)+/,"")),fullUrl.replace(/\#$/,"")},History.getShortUrl=function(url){var shortUrl=url,baseUrl=History.getBaseUrl(),rootUrl=History.getRootUrl();return History.emulated.pushState&&(shortUrl=shortUrl.replace(baseUrl,"")),shortUrl=shortUrl.replace(rootUrl,"/"),History.isTraditionalAnchor(shortUrl)&&(shortUrl="./"+shortUrl),shortUrl=shortUrl.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},History.getLocationHref=function(doc){return(doc=doc||document).URL===doc.location.href?doc.location.href:doc.location.href===decodeURIComponent(doc.URL)?doc.URL:doc.location.hash&&decodeURIComponent(doc.location.href.replace(/^[^#]+/,""))===doc.location.hash||-1==doc.URL.indexOf("#")&&-1!=doc.location.href.indexOf("#")?doc.location.href:doc.URL||doc.location.href},History.store={},History.idToState=History.idToState||{},History.stateToId=History.stateToId||{},History.urlToId=History.urlToId||{},History.storedStates=History.storedStates||[],History.savedStates=History.savedStates||[],History.normalizeStore=function(){History.store.idToState=History.store.idToState||{},History.store.urlToId=History.store.urlToId||{},History.store.stateToId=History.store.stateToId||{}},History.getState=function(friendly,create){void 0===friendly&&(friendly=!0),void 0===create&&(create=!0);var State=History.getLastSavedState();return!State&&create&&(State=History.createStateObject()),friendly&&((State=History.cloneObject(State)).url=State.cleanUrl||State.url),State},History.getIdByState=function(newState){var id=History.extractId(newState.url),str;if(!id)if(str=History.getStateString(newState),void 0!==History.stateToId[str])id=History.stateToId[str];else if(void 0!==History.store.stateToId[str])id=History.store.stateToId[str];else{for(;id=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),void 0!==History.idToState[id]||void 0!==History.store.idToState[id];);History.stateToId[str]=id,History.idToState[id]=newState}return id},History.normalizeState=function(oldState){var newState,dataNotEmpty;return oldState&&"object"==typeof oldState||(oldState={}),void 0!==oldState.normalized?oldState:(oldState.data&&"object"==typeof oldState.data||(oldState.data={}),(newState={}).normalized=!0,newState.title=oldState.title||"",newState.url=History.getFullUrl(oldState.url?oldState.url:History.getLocationHref()),newState.hash=History.getShortUrl(newState.url),newState.data=History.cloneObject(oldState.data),newState.id=History.getIdByState(newState),newState.cleanUrl=newState.url.replace(/\??\&_suid.*/,""),newState.url=newState.cleanUrl,dataNotEmpty=!History.isEmptyObject(newState.data),(newState.title||dataNotEmpty)&&!0!==History.options.disableSuid&&(newState.hash=History.getShortUrl(newState.url).replace(/\??\&_suid.*/,""),/\?/.test(newState.hash)||(newState.hash+="?"),newState.hash+="&_suid="+newState.id),newState.hashedUrl=History.getFullUrl(newState.hash),(History.emulated.pushState||History.bugs.safariPoll)&&History.hasUrlDuplicate(newState)&&(newState.url=newState.hashedUrl),newState)},History.createStateObject=function(data,title,url){var State={data:data,title:title,url:url};return State=History.normalizeState(State)},History.getStateById=function(id){var State;return id=String(id),History.idToState[id]||History.store.idToState[id]||void 0},History.getStateString=function(passedState){var State,cleanedState,str;return cleanedState={data:(State=History.normalizeState(passedState)).data,title:passedState.title,url:passedState.url},str=JSON.stringify(cleanedState)},History.getStateId=function(passedState){var State,id;return id=(State=History.normalizeState(passedState)).id},History.getHashByState=function(passedState){var State,hash;return hash=(State=History.normalizeState(passedState)).hash},History.extractId=function(url_or_hash){var id,parts,url,tmp;return tmp=-1!=url_or_hash.indexOf("#")?url_or_hash.split("#")[0]:url_or_hash,url=(parts=/(.*)\&_suid=([0-9]+)$/.exec(tmp))&&parts[1]||url_or_hash,(id=parts?String(parts[2]||""):"")||!1},History.isTraditionalAnchor=function(url_or_hash){var isTraditional;return!/[\/\?\.]/.test(url_or_hash)},History.extractState=function(url_or_hash,create){var State=null,id,url;return create=create||!1,(id=History.extractId(url_or_hash))&&(State=History.getStateById(id)),State||(url=History.getFullUrl(url_or_hash),(id=History.getIdByUrl(url)||!1)&&(State=History.getStateById(id)),State||!create||History.isTraditionalAnchor(url_or_hash)||(State=History.createStateObject(null,null,url))),State},History.getIdByUrl=function(url){var id;return History.urlToId[url]||History.store.urlToId[url]||void 0},History.getLastSavedState=function(){return History.savedStates[History.savedStates.length-1]||void 0},History.getLastStoredState=function(){return History.storedStates[History.storedStates.length-1]||void 0},History.hasUrlDuplicate=function(newState){var hasDuplicate=!1,oldState;return hasDuplicate=(oldState=History.extractState(newState.url))&&oldState.id!==newState.id},History.storeState=function(newState){return History.urlToId[newState.url]=newState.id,History.storedStates.push(History.cloneObject(newState)),newState},History.isLastSavedState=function(newState){var isLast=!1,newId,oldState,oldId;return History.savedStates.length&&(isLast=(newId=newState.id)===(oldId=(oldState=History.getLastSavedState()).id)),isLast},History.saveState=function(newState){return!History.isLastSavedState(newState)&&(History.savedStates.push(History.cloneObject(newState)),!0)},History.getStateByIndex=function(index){var State=null;return State=void 0===index?History.savedStates[History.savedStates.length-1]:index<0?History.savedStates[History.savedStates.length+index]:History.savedStates[index]},History.getCurrentIndex=function(){var index=null;return index=History.savedStates.length<1?0:History.savedStates.length-1},History.getHash=function(doc){var url=History.getLocationHref(doc),hash;return hash=History.getHashByUrl(url)},History.unescapeHash=function(hash){var result=History.normalizeHash(hash);return result=decodeURIComponent(result)},History.normalizeHash=function(hash){var result;return hash.replace(/[^#]*#/,"").replace(/#.*/,"")},History.setHash=function(hash,queue){var State,pageUrl;return!1!==queue&&History.busy()?(History.pushQueue({scope:History,callback:History.setHash,args:arguments,queue:queue}),!1):(History.busy(!0),(State=History.extractState(hash,!0))&&!History.emulated.pushState?History.pushState(State.data,State.title,State.url,!1):History.getHash()!==hash&&(History.bugs.setHash?(pageUrl=History.getPageUrl(),History.pushState(null,null,pageUrl+"#"+hash,!1)):document.location.hash=hash),History)},History.escapeHash=function(hash){var result=History.normalizeHash(hash);return result=window.encodeURIComponent(result),History.bugs.hashEscape||(result=result.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),result},History.getHashByUrl=function(url){var hash=String(url).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return hash=History.unescapeHash(hash)},History.setTitle=function(newState){var title=newState.title,firstState;title||(firstState=History.getStateByIndex(0))&&firstState.url===newState.url&&(title=firstState.title||History.options.initialTitle);try{document.getElementsByTagName("title")[0].innerHTML=title.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(Exception){}return document.title=title,History},History.queues=[],History.busy=function(value){if(void 0!==value?History.busy.flag=value:void 0===History.busy.flag&&(History.busy.flag=!1),!History.busy.flag){clearTimeout(History.busy.timeout);var fireNext=function(){var i,queue,item;if(!History.busy.flag)for(i=History.queues.length-1;i>=0;--i)0!==(queue=History.queues[i]).length&&(item=queue.shift(),History.fireQueueItem(item),History.busy.timeout=setTimeout(fireNext,History.options.busyDelay))};History.busy.timeout=setTimeout(fireNext,History.options.busyDelay)}return History.busy.flag},History.busy.flag=!1,History.fireQueueItem=function(item){return item.callback.apply(item.scope||History,item.args||[])},History.pushQueue=function(item){return History.queues[item.queue||0]=History.queues[item.queue||0]||[],History.queues[item.queue||0].push(item),History},History.queue=function(item,queue){return"function"==typeof item&&(item={callback:item}),void 0!==queue&&(item.queue=queue),History.busy()?History.pushQueue(item):History.fireQueueItem(item),History},History.clearQueue=function(){return History.busy.flag=!1,History.queues=[],History},History.stateChanged=!1,History.doubleChecker=!1,History.doubleCheckComplete=function(){return History.stateChanged=!0,History.doubleCheckClear(),History},History.doubleCheckClear=function(){return History.doubleChecker&&(clearTimeout(History.doubleChecker),History.doubleChecker=!1),History},History.doubleCheck=function(tryAgain){return History.stateChanged=!1,History.doubleCheckClear(),History.bugs.ieDoubleCheck&&(History.doubleChecker=setTimeout((function(){return History.doubleCheckClear(),History.stateChanged||tryAgain(),!0}),History.options.doubleCheckInterval)),History},History.safariStatePoll=function(){var urlState=History.extractState(History.getLocationHref()),newState;if(!History.isLastSavedState(urlState))return(newState=urlState)||(newState=History.createStateObject()),History.Adapter.trigger(window,"popstate"),History},History.back=function(queue){return!1!==queue&&History.busy()?(History.pushQueue({scope:History,callback:History.back,args:arguments,queue:queue}),!1):(History.busy(!0),History.doubleCheck((function(){History.back(!1)})),history.go(-1),!0)},History.forward=function(queue){return!1!==queue&&History.busy()?(History.pushQueue({scope:History,callback:History.forward,args:arguments,queue:queue}),!1):(History.busy(!0),History.doubleCheck((function(){History.forward(!1)})),history.go(1),!0)},History.go=function(index,queue){var i;if(index>0)for(i=1;i<=index;++i)History.forward(queue);else{if(!(index<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(i=-1;i>=index;--i)History.back(queue)}return History},History.emulated.pushState){var emptyFunction=function(){};History.pushState=History.pushState||emptyFunction,History.replaceState=History.replaceState||emptyFunction}else History.onPopState=function(event,extra){var stateId=!1,newState=!1,currentHash,currentState;return History.doubleCheckComplete(),(currentHash=History.getHash())?((currentState=History.extractState(currentHash||History.getLocationHref(),!0))?History.replaceState(currentState.data,currentState.title,currentState.url,!1):(History.Adapter.trigger(window,"anchorchange"),History.busy(!1)),History.expectedStateId=!1,!1):((newState=(stateId=History.Adapter.extractEventData("state",event,extra)||!1)?History.getStateById(stateId):History.expectedStateId?History.getStateById(History.expectedStateId):History.extractState(History.getLocationHref()))||(newState=History.createStateObject(null,null,History.getLocationHref())),History.expectedStateId=!1,History.isLastSavedState(newState)?(History.busy(!1),!1):(History.storeState(newState),History.saveState(newState),History.setTitle(newState),History.Adapter.trigger(window,"statechange"),History.busy(!1),!0))},History.Adapter.bind(window,"popstate",History.onPopState),History.pushState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==queue&&History.busy())return History.pushQueue({scope:History,callback:History.pushState,args:arguments,queue:queue}),!1;History.busy(!0);var newState=History.createStateObject(data,title,url);return History.isLastSavedState(newState)?History.busy(!1):(History.storeState(newState),History.expectedStateId=newState.id,history.pushState(newState.id,newState.title,newState.url),History.Adapter.trigger(window,"popstate")),!0},History.replaceState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==queue&&History.busy())return History.pushQueue({scope:History,callback:History.replaceState,args:arguments,queue:queue}),!1;History.busy(!0);var newState=History.createStateObject(data,title,url);return History.isLastSavedState(newState)?History.busy(!1):(History.storeState(newState),History.expectedStateId=newState.id,history.replaceState(newState.id,newState.title,newState.url),History.Adapter.trigger(window,"popstate")),!0};if(sessionStorage){try{History.store=JSON.parse(sessionStorage.getItem("History.store"))||{}}catch(err){History.store={}}History.normalizeStore()}else History.store={},History.normalizeStore();History.Adapter.bind(window,"unload",History.clearAllIntervals),History.saveState(History.storeState(History.extractState(History.getLocationHref(),!0))),sessionStorage&&(History.onUnload=function(){var currentStore,item,currentStoreString;try{currentStore=JSON.parse(sessionStorage.getItem("History.store"))||{}}catch(err){currentStore={}}for(item in currentStore.idToState=currentStore.idToState||{},currentStore.urlToId=currentStore.urlToId||{},currentStore.stateToId=currentStore.stateToId||{},History.idToState)History.idToState.hasOwnProperty(item)&&(currentStore.idToState[item]=History.idToState[item]);for(item in History.urlToId)History.urlToId.hasOwnProperty(item)&&(currentStore.urlToId[item]=History.urlToId[item]);for(item in History.stateToId)History.stateToId.hasOwnProperty(item)&&(currentStore.stateToId[item]=History.stateToId[item]);History.store=currentStore,History.normalizeStore(),currentStoreString=JSON.stringify(currentStore);try{sessionStorage.setItem("History.store",currentStoreString)}catch(e){if(e.code!==DOMException.QUOTA_EXCEEDED_ERR)throw e;sessionStorage.length&&(sessionStorage.removeItem("History.store"),sessionStorage.setItem("History.store",currentStoreString))}},History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval)),History.Adapter.bind(window,"beforeunload",History.onUnload),History.Adapter.bind(window,"unload",History.onUnload)),History.emulated.pushState||(History.bugs.safariPoll&&History.intervalList.push(setInterval(History.safariStatePoll,History.options.safariPollInterval)),"Apple Computer, Inc."!==navigator.vendor&&"Mozilla"!==(navigator.appCodeName||"")||(History.Adapter.bind(window,"hashchange",(function(){History.Adapter.trigger(window,"popstate")})),History.getHash()&&History.Adapter.onDomLoad((function(){History.Adapter.trigger(window,"hashchange")}))))},History.options&&History.options.delayInit||History.init()}(window);
//# sourceMappingURL=history.min.js.map