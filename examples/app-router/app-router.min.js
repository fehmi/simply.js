// @license Copyright (C) 2015 Erik Ringsmuth - MIT license
!function(window,document){var utilities={},importedURIs={},isIE="ActiveXObject"in window,isEdge=!!window.navigator.userAgent.match(/Edge/),previousUrl={},AppRouter=Object.create(HTMLElement.prototype);function fire(type,detail,node){var event=document.createEvent("CustomEvent");return event.initCustomEvent(type,!1,!0,detail),node.dispatchEvent(event)}function stateChange(router){var url=utilities.parseUrl(window.location.href,router.getAttribute("mode"));if(url.hash!==previousUrl.hash&&url.path===previousUrl.path&&url.search===previousUrl.search&&url.isHashPath===previousUrl.isHashPath)return"disabled"!==router.getAttribute("scroll-to-hash")&&scrollToHash(url.hash),void(previousUrl=url);previousUrl=url;var eventDetail={path:url.path,state:window.history.state};if(fire("state-change",eventDetail,router)){for(var route=router.firstElementChild;route;){if("APP-ROUTE"===route.tagName&&utilities.testRoute(route.getAttribute("path"),url.path,router.getAttribute("trailingSlash"),route.hasAttribute("regex")))return void activateRoute(router,route,url);route=route.nextSibling}fire("not-found",eventDetail,router)}}function activateRoute(router,route,url){if(route.hasAttribute("redirect"))router.go(route.getAttribute("redirect"),{replace:!0});else if(route!==router.activeRoute||"noop"!==route.getAttribute("onUrlChange")){var eventDetail={path:url.path,route:route,oldRoute:router.activeRoute,state:window.history.state};fire("activate-route-start",eventDetail,router)&&fire("activate-route-start",eventDetail,route)&&(router.loadingRoute=route,route===router.activeRoute&&"updateModel"===route.getAttribute("onUrlChange")?updateModelAndActivate(router,route,url,eventDetail):route.hasAttribute("import")?importAndActivate(router,route.getAttribute("import"),route,url,eventDetail):route.hasAttribute("element")?activateCustomElement(router,route.getAttribute("element"),route,url,eventDetail):route.firstElementChild&&"TEMPLATE"===route.firstElementChild.tagName&&(route.isInlineTemplate=!0,activateTemplate(router,route.firstElementChild,route,url,eventDetail)))}}function updateModelAndActivate(router,route,url,eventDetail){var model=createModel(router,route,url,eventDetail);route.hasAttribute("template")||route.isInlineTemplate?setObjectProperties(route.lastElementChild.templateInstance.model,model):setObjectProperties(route.firstElementChild,model),fire("activate-route-end",eventDetail,router),fire("activate-route-end",eventDetail,eventDetail.route)}function importAndActivate(router,importUri,route,url,eventDetail){var importLink;function importLoadedCallback(){importLink.loaded=!0,activateImport(router,importLink,importUri,route,url,eventDetail)}function importErrorCallback(event){var errorDetail={errorEvent:event,importUri:importUri,routeDetail:eventDetail};fire("import-error",errorDetail,router),fire("import-error",errorDetail,route)}importedURIs.hasOwnProperty(importUri)?(importLink=importedURIs[importUri]).loaded?activateImport(router,importLink,importUri,route,url,eventDetail):(importLink.addEventListener("load",importLoadedCallback),importLink.addEventListener("error",importErrorCallback)):((importLink=document.createElement("link")).setAttribute("rel","import"),importLink.setAttribute("href",importUri),importLink.setAttribute("async","async"),importLink.addEventListener("load",importLoadedCallback),importLink.addEventListener("error",importErrorCallback),importLink.loaded=!1,document.head.appendChild(importLink),importedURIs[importUri]=importLink)}function activateImport(router,importLink,importUri,route,url,eventDetail){if(route.importLink=importLink,route===router.loadingRoute)if(route.hasAttribute("template")){var templateId=route.getAttribute("template"),template;activateTemplate(router,template=templateId?importLink.import.getElementById(templateId):importLink.import.querySelector("template"),route,url,eventDetail)}else activateCustomElement(router,route.getAttribute("element")||importUri.split("/").slice(-1)[0].replace(".html",""),route,url,eventDetail)}function activateCustomElement(router,elementName,route,url,eventDetail){var customElement=document.createElement(elementName),model;setObjectProperties(customElement,createModel(router,route,url,eventDetail)),activateElement(router,customElement,url,eventDetail)}function activateTemplate(router,template,route,url,eventDetail){var templateInstance;if("createInstance"in template){var model=createModel(router,route,url,eventDetail);templateInstance=template.createInstance(model)}else templateInstance=document.importNode(template.content,!0);activateElement(router,templateInstance,url,eventDetail)}function createModel(router,route,url,eventDetail){var model=utilities.routeArguments(route.getAttribute("path"),url.path,url.search,route.hasAttribute("regex"),"auto"===router.getAttribute("typecast"));return(route.hasAttribute("bindRouter")||router.hasAttribute("bindRouter"))&&(model.router=router),eventDetail.model=model,fire("before-data-binding",eventDetail,router),fire("before-data-binding",eventDetail,eventDetail.route),eventDetail.model}function setObjectProperties(object,model){for(var property in model)model.hasOwnProperty(property)&&(object[property]=model[property])}function activateElement(router,element,url,eventDetail){deactivateRoute(router.previousRoute),router.previousRoute=router.activeRoute,router.activeRoute=router.loadingRoute,router.loadingRoute=null,router.previousRoute&&router.previousRoute.removeAttribute("active"),router.activeRoute.setAttribute("active","active"),router.hasAttribute("core-animated-pages")&&eventDetail.route!==eventDetail.oldRoute||deactivateRoute(router.previousRoute),router.activeRoute.appendChild(element),router.hasAttribute("core-animated-pages")&&(router.coreAnimatedPages.selected=router.activeRoute.getAttribute("path")),url.hash&&!router.hasAttribute("core-animated-pages")&&"disabled"!==router.getAttribute("scroll-to-hash")&&scrollToHash(url.hash),fire("activate-route-end",eventDetail,router),fire("activate-route-end",eventDetail,eventDetail.route)}function deactivateRoute(route){if(route){var node=route.firstChild;for(route.isInlineTemplate&&(node=route.querySelector("template").nextSibling);node;){var nodeToRemove=node;node=node.nextSibling,route.removeChild(nodeToRemove)}}}function scrollToHash(hash){hash&&setTimeout((function(){var hashElement;try{hashElement=document.querySelector("html /deep/ "+hash)||document.querySelector('html /deep/ [name="'+hash.substring(1)+'"]')}catch(e){hashElement=document.querySelector(hash)||document.querySelector('[name="'+hash.substring(1)+'"]')}hashElement&&hashElement.scrollIntoView&&hashElement.scrollIntoView(!0)}),0)}function segmentsMatch(routeSegments,routeIndex,urlSegments,urlIndex,pathVariables){var routeSegment=routeSegments[routeIndex],urlSegment=urlSegments[urlIndex];if("**"===routeSegment&&routeIndex===routeSegments.length-1)return!0;if(void 0===routeSegment||void 0===urlSegment)return routeSegment===urlSegment;if(routeSegment===urlSegment||"*"===routeSegment||":"===routeSegment.charAt(0))return":"===routeSegment.charAt(0)&&void 0!==pathVariables&&(pathVariables[routeSegment.substring(1)]=urlSegments[urlIndex]),segmentsMatch(routeSegments,routeIndex+1,urlSegments,urlIndex+1,pathVariables);if("**"===routeSegment)for(var i=urlIndex;i<urlSegments.length;i++)if(segmentsMatch(routeSegments,routeIndex+1,urlSegments,i,pathVariables))return!0;return!1}AppRouter.util=utilities,document.registerElement("app-route",{prototype:Object.create(HTMLElement.prototype)}),AppRouter.attachedCallback=function(){"manual"!==this.getAttribute("init")&&this.init()},AppRouter.init=function(){var router=this;router.isInitialized||(router.isInitialized=!0,router.hasAttribute("trailingSlash")||router.setAttribute("trailingSlash","strict"),router.hasAttribute("mode")||router.setAttribute("mode","auto"),router.hasAttribute("typecast")||router.setAttribute("typecast","auto"),router.hasAttribute("scroll-to-hash")||router.setAttribute("scroll-to-hash","auto"),router.hasAttribute("core-animated-pages")&&(router.createShadowRoot(),router.coreAnimatedPages=document.createElement("core-animated-pages"),router.coreAnimatedPages.appendChild(document.createElement("content")),router.coreAnimatedPages.style.position="static",router.coreAnimatedPages.setAttribute("valueattr","path"),router.coreAnimatedPages.setAttribute("transitions",router.getAttribute("transitions")),router.shadowRoot.appendChild(router.coreAnimatedPages),router.coreAnimatedPages.addEventListener("core-animated-pages-transition-end",(function(){router.previousRoute&&!router.previousRoute.hasAttribute("active")&&deactivateRoute(router.previousRoute)}))),router.stateChangeHandler=stateChange.bind(null,router),window.addEventListener("popstate",router.stateChangeHandler,!1),(isIE||isEdge)&&window.addEventListener("hashchange",router.stateChangeHandler,!1),stateChange(router))},AppRouter.detachedCallback=function(){window.removeEventListener("popstate",this.stateChangeHandler,!1),(isIE||isEdge)&&window.removeEventListener("hashchange",this.stateChangeHandler,!1)},AppRouter.go=function(path,options){"pushstate"!==this.getAttribute("mode")&&(path="hashbang"===this.getAttribute("mode")?"#!"+path:"#"+path);var currentState=window.history.state;options&&!0===options.replace?window.history.replaceState(currentState,null,path):window.history.pushState(currentState,null,path);try{var popstateEvent=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:currentState});"dispatchEvent_"in window?window.dispatchEvent_(popstateEvent):window.dispatchEvent(popstateEvent)}catch(error){var fallbackEvent=document.createEvent("CustomEvent");fallbackEvent.initCustomEvent("popstate",!1,!1,{state:currentState}),window.dispatchEvent(fallbackEvent)}},utilities.parseUrl=function(location,mode){var url={isHashPath:"hash"===mode};if("function"==typeof URL){var nativeUrl=new URL(location);url.path=nativeUrl.pathname,url.hash=nativeUrl.hash,url.search=nativeUrl.search}else{var anchor=document.createElement("a");anchor.href=location,url.path=anchor.pathname,"/"!==url.path.charAt(0)&&(url.path="/"+url.path),url.hash=anchor.hash,url.search=anchor.search}if("pushstate"!==mode&&("#/"===url.hash.substring(0,2)?(url.isHashPath=!0,url.path=url.hash.substring(1)):"#!/"===url.hash.substring(0,3)?(url.isHashPath=!0,url.path=url.hash.substring(2)):url.isHashPath&&(0===url.hash.length?url.path="/":url.path=url.hash.substring(1)),url.isHashPath)){url.hash="";var secondHashIndex=url.path.indexOf("#");-1!==secondHashIndex&&(url.hash=url.path.substring(secondHashIndex),url.path=url.path.substring(0,secondHashIndex));var searchIndex=url.path.indexOf("?");-1!==searchIndex&&(url.search=url.path.substring(searchIndex),url.path=url.path.substring(0,searchIndex))}return url},utilities.testRoute=function(routePath,urlPath,trailingSlashOption,isRegExp){return"ignore"===trailingSlashOption&&("/"===urlPath.slice(-1)&&(urlPath=urlPath.slice(0,-1)),"/"!==routePath.slice(-1)||isRegExp||(routePath=routePath.slice(0,-1))),isRegExp?utilities.testRegExString(routePath,urlPath):routePath===urlPath||"*"===routePath||("/"!==routePath.charAt(0)&&(routePath="/**/"+routePath),segmentsMatch(routePath.split("/"),1,urlPath.split("/"),1))},utilities.routeArguments=function(routePath,urlPath,search,isRegExp,typecast){var args={};isRegExp||("/"!==routePath.charAt(0)&&(routePath="/**/"+routePath),segmentsMatch(routePath.split("/"),1,urlPath.split("/"),1,args));var queryParameters=search.substring(1).split("&");1===queryParameters.length&&""===queryParameters[0]&&(queryParameters=[]);for(var i=0;i<queryParameters.length;i++){var queryParameter,queryParameterParts=queryParameters[i].split("=");args[queryParameterParts[0]]=queryParameterParts.splice(1,queryParameterParts.length-1).join("=")}if(typecast)for(var arg in args)args[arg]=utilities.typecast(args[arg]);return args},utilities.typecast=function(value){return"true"===value||"false"!==value&&(isNaN(value)||""===value||"0"===value.charAt(0)?decodeURIComponent(value):+value)},utilities.testRegExString=function(pattern,value){if("/"!==pattern.charAt(0))return!1;var options="";if("/"===(pattern=pattern.slice(1)).slice(-1))pattern=pattern.slice(0,-1);else{if("/i"!==pattern.slice(-2))return!1;pattern=pattern.slice(0,-2),options="i"}return new RegExp(pattern,options).test(value)},document.registerElement("app-router",{prototype:AppRouter})}(window,document);
//# sourceMappingURL=app-router.min.js.map